//BOND! https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js
//BOND! meta.js

const DefaultCellSize = 30;
let SimulatorWidth = 1000;
let SimulatorHeight = 600;
let ThemeColor = new SVG.Color('#000');
let BorderColor = new SVG.Color(ThemeColor.brightness() >= 0.5 ? '#333' : '#999');

let BUTTON = function (draw, x, y, width, height, text, onclick, onhover) {
    this.x = x;
    this.y = y;
    this.width = width;
    this.height = height;
    this.text = text;
    this.onclick = onclick;
    this.onhover = onhover;

    this.construct(draw, x, y, width, height, text, onclick, onhover);
};

let GRID = function (svg, gridsvg, OffsetX, OffsetY) {
    this.OffsetX = OffsetX;
    this.OffsetY = OffsetY;
    this.Origin = { x: 0, y: 0 };
    this.State = new Array(5000);
    this.Cells = new Array(5000);
    this.DefaultCellSize = 30;
    this.CellSize = 30;
    this.CellWidth = SimulatorWidth / this.CellSize;
    this.CellHeight = SimulatorHeight / this.CellSize;
    this.Scale = 1.0;
    this.CellSVG = svg;
    this.CellGroup = svg.group();
    this.GridSVG = gridsvg;

    this.AliveHash = {};
    this.runningId = 0;
    
    this.construct(svg, gridsvg, OffsetX, OffsetY);
};
let PATTERNS = {
    0: 0, 256: 0, 128: 0, 384: 0, 64: 0, 320: 0, 192: 0, 448: 144, 32: 0, 288: 0, 160: 0, 416: 432, 96: 0, 352: 144, 224: 144, 480: 416, 16: 0, 272: 0, 144: 0, 400: 432, 80: 0, 336: 144, 208: 216, 464: 504, 48: 0, 304: 432, 176: 432, 432: 432, 112: 144, 368: 304, 240: 504, 496: 360, 8: 0, 264: 0, 136: 0, 392: 144, 72: 0, 328: 144, 200: 216, 456: 200, 40: 0, 296: 144, 168: 144, 424: 416, 104: 144, 360: 0, 232: 200, 488: 360, 24: 0, 280: 144, 152: 216, 408: 504, 88: 216, 344: 88, 216: 216, 472: 360, 56: 146, 312: 306, 184: 506, 440: 362, 120: 90, 376: 362, 248: 362, 504: 362, 4: 0, 260: 0, 132: 0, 388: 48, 68: 0, 324: 16, 196: 16, 452: 160, 36: 0, 292: 48, 164: 48, 420: 416, 100: 16, 356: 160, 228: 160, 484: 416, 20: 0, 276: 48, 148: 48, 404: 400, 84: 16, 340: 176, 212: 248, 468: 456, 52: 54, 308: 438, 180: 438, 436: 390, 116: 182, 372: 294, 244: 494, 500: 334, 12: 0, 268: 16, 140: 16, 396: 160, 76: 16, 332: 128, 204: 200, 460: 232, 44: 18, 300: 162, 172: 162, 428: 418, 108: 130, 364: 34, 236: 234, 492: 362, 28: 18, 284: 178, 156: 250, 412: 458, 92: 218, 348: 106, 220: 234, 476: 330, 60: 180, 316: 292, 188: 492, 444: 332, 124: 108, 380: 364, 252: 364, 508: 332, 2: 0, 258: 0, 130: 0, 386: 48, 66: 0, 322: 16, 194: 24, 450: 168, 34: 0, 290: 48, 162: 48, 418: 416, 98: 16, 354: 160, 226: 168, 482: 424, 18: 0, 274: 48, 146: 56, 402: 408, 82: 24, 338: 184, 210: 240, 466: 448, 50: 54, 306: 438, 178: 446, 434: 398, 114: 190, 370: 302, 242: 486, 498: 326, 10: 0, 266: 16, 138: 24, 394: 168, 74: 24, 330: 136, 202: 200, 458: 232, 42: 18, 298: 162, 170: 170, 426: 426, 106: 138, 362: 42, 234: 234, 490: 362, 26: 27, 282: 187, 154: 251, 410: 459, 90: 219, 346: 107, 218: 227, 474: 323, 58: 191, 314: 303, 186: 495, 442: 335, 122: 111, 378: 367, 250: 359, 506: 327, 6: 0, 262: 48, 134: 48, 390: 0, 70: 16, 326: 32, 198: 40, 454: 136, 38: 54, 294: 38, 166: 38, 422: 390, 102: 38, 358: 166, 230: 174, 486: 398, 22: 54, 278: 22, 150: 30, 406: 398, 86: 62, 342: 142, 214: 198, 470: 454, 54: 54, 310: 390, 182: 398, 438: 398, 118: 174, 374: 270, 246: 454, 502: 326, 14: 18, 270: 34, 142: 42, 398: 138, 78: 10, 334: 170, 206: 234, 462: 202, 46: 38, 302: 166, 174: 174, 430: 398, 110: 174, 366: 46, 238: 238, 494: 334, 30: 63, 286: 143, 158: 207, 414: 463, 94: 239, 350: 79, 222: 199, 478: 327, 62: 173, 318: 269, 190: 461, 446: 333, 126: 109, 382: 333, 254: 325, 510: 325, 1: 0, 257: 0, 129: 0, 385: 16, 65: 0, 321: 16, 193: 24, 449: 136, 33: 0, 289: 16, 161: 16, 417: 416, 97: 16, 353: 128, 225: 136, 481: 424, 17: 0, 273: 16, 145: 24, 401: 440, 81: 24, 337: 152, 209: 208, 465: 480, 49: 18, 305: 434, 177: 442, 433: 426, 113: 154, 369: 298, 241: 482, 497: 354, 9: 0, 265: 16, 137: 24, 393: 136, 73: 24, 329: 136, 201: 200, 457: 200, 41: 18, 297: 130, 169: 138, 425: 426, 105: 138, 361: 10, 233: 202, 489: 362, 25: 27, 281: 155, 153: 219, 409: 491, 89: 219, 345: 75, 217: 195, 473: 355, 57: 153, 313: 297, 185: 489, 441: 361, 121: 73, 377: 361, 249: 353, 505: 353, 5: 0, 261: 16, 133: 16, 389: 32, 69: 16, 325: 0, 197: 8, 453: 168, 37: 18, 293: 34, 165: 34, 421: 418, 101: 2, 357: 162, 229: 170, 485: 426, 21: 18, 277: 50, 149: 58, 405: 394, 85: 26, 341: 170, 213: 226, 469: 450, 53: 52, 309: 420, 181: 428, 437: 396, 117: 172, 373: 300, 245: 484, 501: 324, 13: 18, 269: 2, 141: 10, 397: 170, 77: 10, 333: 138, 205: 202, 461: 234, 45: 0, 301: 160, 173: 168, 429: 424, 109: 136, 365: 40, 237: 232, 493: 360, 29: 25, 285: 169, 157: 233, 413: 457, 93: 201, 349: 105, 221: 225, 477: 321, 61: 173, 317: 301, 189: 493, 445: 333, 125: 109, 381: 365, 253: 357, 509: 325, 3: 0, 259: 16, 131: 24, 387: 40, 67: 24, 323: 8, 195: 0, 451: 160, 35: 18, 291: 34, 163: 42, 419: 426, 99: 10, 355: 170, 227: 162, 483: 418, 19: 27, 275: 59, 147: 51, 403: 387, 83: 19, 339: 163, 211: 227, 467: 451, 51: 63, 307: 431, 179: 423, 435: 391, 115: 167, 371: 295, 243: 487, 499: 327, 11: 27, 267: 11, 139: 11, 395: 171, 75: 11, 331: 139, 203: 195, 459: 227, 43: 11, 299: 171, 171: 171, 427: 427, 107: 139, 363: 43, 235: 227, 491: 355, 27: 27, 283: 171, 155: 227, 411: 451, 91: 195, 347: 99, 219: 227, 475: 323, 59: 173, 315: 301, 187: 485, 443: 325, 123: 101, 379: 357, 251: 357, 507: 325, 7: 18, 263: 34, 135: 42, 391: 10, 71: 10, 327: 42, 199: 34, 455: 130, 39: 38, 295: 38, 167: 46, 423: 398, 103: 46, 359: 174, 231: 166, 487: 390, 23: 63, 279: 15, 151: 7, 407: 391, 87: 39, 343: 135, 215: 199, 471: 455, 55: 45, 311: 397, 183: 389, 439: 389, 119: 165, 375: 261, 247: 453, 503: 325, 15: 11, 271: 43, 143: 43, 399: 139, 79: 11, 335: 171, 207: 227, 463: 195, 47: 45, 303: 173, 175: 173, 431: 397, 111: 173, 367: 45, 239: 229, 495: 325, 31: 45, 287: 141, 159: 197, 415: 453, 95: 229, 351: 69, 223: 197, 479: 325, 63: 173, 319: 269, 191: 453, 447: 325, 127: 101, 383: 325, 255: 325, 511: 325
};

